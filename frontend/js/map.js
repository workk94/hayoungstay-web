var areas = [
  {
      name : '구좌읍',
      category: "구좌읍",
      path : [
          new kakao.maps.LatLng(33.48259579585138, 126.90080256500455),
          new kakao.maps.LatLng(33.488652801884214, 126.9106128125579),
          new kakao.maps.LatLng(33.50333497660288, 126.91310370824398),
          new kakao.maps.LatLng(33.51944586551307, 126.90054782137733),
          new kakao.maps.LatLng(33.52643714256011, 126.89281325620973),
          new kakao.maps.LatLng(33.52938898384168, 126.87193955701686),
          new kakao.maps.LatLng(33.52469704872838, 126.86073654032295),
          new kakao.maps.LatLng(33.54059495242576, 126.83089414168707),
          new kakao.maps.LatLng(33.550812444719384, 126.8290122590966),
          new kakao.maps.LatLng(33.558744421012875, 126.82412463028156),
          new kakao.maps.LatLng(33.56067524738308, 126.81549838367505),
          new kakao.maps.LatLng(33.556278957166384, 126.80811250530473),
          new kakao.maps.LatLng(33.555746104277596, 126.79617507000815),
          new kakao.maps.LatLng(33.559592555640535, 126.79326307274542),
          new kakao.maps.LatLng(33.5650701353881, 126.77187037386211),
          new kakao.maps.LatLng(33.565059716335966, 126.7637480526987),
          new kakao.maps.LatLng(33.557144991202485, 126.76019246633835),
          new kakao.maps.LatLng(33.55885341301687, 126.74939607407141),
          new kakao.maps.LatLng(33.55484836769764, 126.73773549175455),
          new kakao.maps.LatLng(33.560361238582594, 126.73025492919017),
          new kakao.maps.LatLng(33.553529334572545, 126.7165938464388),
          new kakao.maps.LatLng(33.553152033592255, 126.70572132465577),
          new kakao.maps.LatLng(33.535048879620156, 126.70627356911322),
          new kakao.maps.LatLng(33.51167345348251, 126.72650905866486),
          new kakao.maps.LatLng(33.50629650174328, 126.734497244534),
          new kakao.maps.LatLng(33.46609121622526, 126.7240898484056),
          new kakao.maps.LatLng(33.457139820433966, 126.72668068651885),
          new kakao.maps.LatLng(33.452000529257866, 126.72026326248756),
          new kakao.maps.LatLng(33.43967922321338, 126.72226616016655),
          new kakao.maps.LatLng(33.42672194187621, 126.73182531732462),
          new kakao.maps.LatLng(33.42373069074822, 126.73426943615395),
          new kakao.maps.LatLng(33.420269219732226, 126.74140476469637),
          new kakao.maps.LatLng(33.42036749957758, 126.75725100532956),
          new kakao.maps.LatLng(33.421020953962, 126.75922232807628),
          new kakao.maps.LatLng(33.423280111207745, 126.7646110702192),
          new kakao.maps.LatLng(33.42352198657028, 126.76504654137733),
          new kakao.maps.LatLng(33.42418452772666, 126.7663390969326),
          new kakao.maps.LatLng(33.428308017478926, 126.77245405458304),
          new kakao.maps.LatLng(33.43170581915084, 126.77665643988217),
          new kakao.maps.LatLng(33.431971545335855, 126.77694770368143),
          new kakao.maps.LatLng(33.434173761204114, 126.7792688654625),
          new kakao.maps.LatLng(33.43438870779942, 126.78120775966703),
          new kakao.maps.LatLng(33.434558729748964, 126.78271471150104),
          new kakao.maps.LatLng(33.43757780164802, 126.78565716127237),
          new kakao.maps.LatLng(33.44008502819848, 126.79703129299702),
          new kakao.maps.LatLng(33.44570167981284, 126.81456899926104),
          new kakao.maps.LatLng(33.44658971771424, 126.81649479752389),
          new kakao.maps.LatLng(33.447095701913405, 126.81758241444177),
          new kakao.maps.LatLng(33.44782521369849, 126.81821288008966),
          new kakao.maps.LatLng(33.44760597903616, 126.81911244639915),
          new kakao.maps.LatLng(33.44708883059316, 126.820766825669),
          new kakao.maps.LatLng(33.45121583804508, 126.82403731886217),
          new kakao.maps.LatLng(33.4619186815341, 126.84618354640112),
          new kakao.maps.LatLng(33.46500948809512, 126.85612394799642),
          new kakao.maps.LatLng(33.46837753021805, 126.8635725008823),
          new kakao.maps.LatLng(33.474931545249746, 126.87256649263821),
          new kakao.maps.LatLng(33.475125509764844, 126.87303845083818),
          new kakao.maps.LatLng(33.47537036450729, 126.87533833218605),
          new kakao.maps.LatLng(33.4756052435155, 126.87590950935001),
          new kakao.maps.LatLng(33.4757623125706, 126.87765964228045),
          new kakao.maps.LatLng(33.48068605265145, 126.88450376354218),
          new kakao.maps.LatLng(33.48172010020517, 126.89519610076361),
          new kakao.maps.LatLng(33.48213828620919, 126.89715646770512),
          new kakao.maps.LatLng(33.48259579585138, 126.90080256500455)
      ]
  }, {
      name : '조천읍',
      category: '조천읍',
      path : [
          new kakao.maps.LatLng(33.553152033592255, 126.70572132465577),
          new kakao.maps.LatLng(33.548473576317356, 126.68808093217656),
          new kakao.maps.LatLng(33.55244224821579, 126.6777776434858),
          new kakao.maps.LatLng(33.546107144435794, 126.67391585199167),
          new kakao.maps.LatLng(33.54335933072163, 126.66405077843156),
          new kakao.maps.LatLng(33.551195042881275, 126.65435040853376),
          new kakao.maps.LatLng(33.554615328559066, 126.64452727390227),
          new kakao.maps.LatLng(33.53637452420147, 126.63534008202491),
          new kakao.maps.LatLng(33.53811588312059, 126.61310465023735),
          new kakao.maps.LatLng(33.5347736509373, 126.60309165799264),
          new kakao.maps.LatLng(33.52779624704315, 126.5989430907895),
          new kakao.maps.LatLng(33.52019823472573, 126.60029834075134),
          new kakao.maps.LatLng(33.5169672044131, 126.61185029346709),
          new kakao.maps.LatLng(33.513638210286345, 126.6210905935246),
          new kakao.maps.LatLng(33.51362144718688, 126.62107802009812),
          new kakao.maps.LatLng(33.50685485048139, 126.61926033277396),
          new kakao.maps.LatLng(33.49604072367715, 126.62212911180187),
          new kakao.maps.LatLng(33.4958458773036, 126.62222239820977),
          new kakao.maps.LatLng(33.48825348607767, 126.62843062753414),
          new kakao.maps.LatLng(33.48797751297371, 126.6286810663321),
          new kakao.maps.LatLng(33.4877979542642, 126.62881997230933),
          new kakao.maps.LatLng(33.48760935159341, 126.62877862216521),
          new kakao.maps.LatLng(33.486397059593834, 126.62892006449759),
          new kakao.maps.LatLng(33.486289650208384, 126.62903629984753),
          new kakao.maps.LatLng(33.48622611244675, 126.62920361775834),
          new kakao.maps.LatLng(33.48616503740635, 126.62934743624783),
          new kakao.maps.LatLng(33.47536376815813, 126.63703687871163),
          new kakao.maps.LatLng(33.474952904396616, 126.63715140015942),
          new kakao.maps.LatLng(33.47465396523956, 126.63729064855836),
          new kakao.maps.LatLng(33.474253120409415, 126.63740908502658),
          new kakao.maps.LatLng(33.469049327211565, 126.63713943203166),
          new kakao.maps.LatLng(33.46855824500533, 126.6372530211774),
          new kakao.maps.LatLng(33.464501333594534, 126.63919556282791),
          new kakao.maps.LatLng(33.46418914160286, 126.63962329367672),
          new kakao.maps.LatLng(33.463273648916626, 126.64074350912327),
          new kakao.maps.LatLng(33.46307125695725, 126.64086405049665),
          new kakao.maps.LatLng(33.44481033554035, 126.63995843598616),
          new kakao.maps.LatLng(33.43967249147264, 126.64224801732529),
          new kakao.maps.LatLng(33.42728250411067, 126.63673605444069),
          new kakao.maps.LatLng(33.417148392492734, 126.62131969939213),
          new kakao.maps.LatLng(33.39498115259645, 126.60653368901414),
          new kakao.maps.LatLng(33.39138212811638, 126.59081453382106),
          new kakao.maps.LatLng(33.38088624964799, 126.57210618945841),
          new kakao.maps.LatLng(33.380774860990186, 126.56346020543484),
          new kakao.maps.LatLng(33.373159336828095, 126.55968500376453),
          new kakao.maps.LatLng(33.371818906373136, 126.57457157742695),
          new kakao.maps.LatLng(33.37434442178888, 126.58932187073997),
          new kakao.maps.LatLng(33.38223750780344, 126.6069339462731),
          new kakao.maps.LatLng(33.38503613729622, 126.62491542496801),
          new kakao.maps.LatLng(33.390190073500015, 126.62633467550623),
          new kakao.maps.LatLng(33.393768374460635, 126.64814039470497),
          new kakao.maps.LatLng(33.39689463006808, 126.6533289316775),
          new kakao.maps.LatLng(33.401958889152105, 126.66046356183607),
          new kakao.maps.LatLng(33.40025517490054, 126.66907361006993),
          new kakao.maps.LatLng(33.40507998187422, 126.6765074265383),
          new kakao.maps.LatLng(33.41919378470278, 126.69961881263625),
          new kakao.maps.LatLng(33.42417727033959, 126.72425797122396),
          new kakao.maps.LatLng(33.42672194187621, 126.73182531732462),
          new kakao.maps.LatLng(33.43967922321338, 126.72226616016655),
          new kakao.maps.LatLng(33.452000529257866, 126.72026326248756),
          new kakao.maps.LatLng(33.457139820433966, 126.72668068651885),
          new kakao.maps.LatLng(33.46609121622526, 126.7240898484056),
          new kakao.maps.LatLng(33.50629650174328, 126.734497244534),
          new kakao.maps.LatLng(33.51167345348251, 126.72650905866486),
          new kakao.maps.LatLng(33.535048879620156, 126.70627356911322),
          new kakao.maps.LatLng(33.553152033592255, 126.70572132465577)
      ]
  }, {
      name : '애월읍',
      category: '애월읍',
      path : [
          new kakao.maps.LatLng(33.49073230445039, 126.42090917694627),
          new kakao.maps.LatLng(33.49004283968061, 126.41062929008406),
          new kakao.maps.LatLng(33.48576086388934, 126.40833057042919),
          new kakao.maps.LatLng(33.48410628870635, 126.39454195163964),
          new kakao.maps.LatLng(33.488984137887506, 126.38550757279555),
          new kakao.maps.LatLng(33.47816753777783, 126.36854009544935),
          new kakao.maps.LatLng(33.477496534554135, 126.35361347647459),
          new kakao.maps.LatLng(33.467026754581035, 126.33807996206508),
          new kakao.maps.LatLng(33.46705492109927, 126.31905674683905),
          new kakao.maps.LatLng(33.46921567102326, 126.31394976835982),
          new kakao.maps.LatLng(33.452177043782264, 126.30634944589252),
          new kakao.maps.LatLng(33.44650184735496, 126.29777463176472),
          new kakao.maps.LatLng(33.44107352049576, 126.29905137500454),
          new kakao.maps.LatLng(33.44061004757684, 126.29901854572422),
          new kakao.maps.LatLng(33.438934552256605, 126.29946538834356),
          new kakao.maps.LatLng(33.43887364353436, 126.2996936212788),
          new kakao.maps.LatLng(33.427314480577614, 126.30356958537432),
          new kakao.maps.LatLng(33.417607865257864, 126.30200751180509),
          new kakao.maps.LatLng(33.40599179562219, 126.30886666343564),
          new kakao.maps.LatLng(33.398020178700115, 126.31013188017671),
          new kakao.maps.LatLng(33.387064399518295, 126.32342963733232),
          new kakao.maps.LatLng(33.37860841125007, 126.3229909166272),
          new kakao.maps.LatLng(33.36674784521495, 126.3337239869726),
          new kakao.maps.LatLng(33.35392710017535, 126.35473695540978),
          new kakao.maps.LatLng(33.34681883422565, 126.37531040891051),
          new kakao.maps.LatLng(33.34303147656545, 126.4038895101389),
          new kakao.maps.LatLng(33.341038940585044, 126.42642377879105),
          new kakao.maps.LatLng(33.346646240079004, 126.43642036177533),
          new kakao.maps.LatLng(33.35626825801128, 126.43854955607654),
          new kakao.maps.LatLng(33.358886921123634, 126.44558152924589),
          new kakao.maps.LatLng(33.36007752691014, 126.46481741149081),
          new kakao.maps.LatLng(33.35737970120916, 126.4767230502085),
          new kakao.maps.LatLng(33.35960286425034, 126.48332886045019),
          new kakao.maps.LatLng(33.35495440159395, 126.49044849213527),
          new kakao.maps.LatLng(33.359846763490154, 126.49909140831033),
          new kakao.maps.LatLng(33.36253922433286, 126.52996803027304),
          new kakao.maps.LatLng(33.36892933479124, 126.52680625149611),
          new kakao.maps.LatLng(33.381773780698616, 126.51257687570866),
          new kakao.maps.LatLng(33.38352820589072, 126.50318838819857),
          new kakao.maps.LatLng(33.390366027468886, 126.49172248030254),
          new kakao.maps.LatLng(33.38812583694319, 126.4762301673471),
          new kakao.maps.LatLng(33.397536300434865, 126.45868152037006),
          new kakao.maps.LatLng(33.39849808896103, 126.45796004302929),
          new kakao.maps.LatLng(33.4146550806149, 126.44961002353865),
          new kakao.maps.LatLng(33.4146550806149, 126.44961002353865),
          new kakao.maps.LatLng(33.414764610816945, 126.44965559199474),
          new kakao.maps.LatLng(33.435606244318215, 126.4465932711369),
          new kakao.maps.LatLng(33.43812336561097, 126.44920975296604),
          new kakao.maps.LatLng(33.43874406476296, 126.4492861743873),
          new kakao.maps.LatLng(33.4493374487745, 126.4465555706355),
          new kakao.maps.LatLng(33.46227428556745, 126.44768733607363),
          new kakao.maps.LatLng(33.46851406269615, 126.44551707519811),
          new kakao.maps.LatLng(33.477820477817055, 126.44306632904689),
          new kakao.maps.LatLng(33.477724339981016, 126.44271777376011),
          new kakao.maps.LatLng(33.47461778351359, 126.43476930265513),
          new kakao.maps.LatLng(33.47457311108453, 126.43441462489217),
          new kakao.maps.LatLng(33.474617204402605, 126.43434294595451),
          new kakao.maps.LatLng(33.47454008457233, 126.43418570006764),
          new kakao.maps.LatLng(33.472967471830884, 126.4250797140689),
          new kakao.maps.LatLng(33.47297201668471, 126.4246417669602),
          new kakao.maps.LatLng(33.474424918557965, 126.42178957208398),
          new kakao.maps.LatLng(33.474682691652326, 126.42182828553702),
          new kakao.maps.LatLng(33.48547816862764, 126.42059680900702),
          new kakao.maps.LatLng(33.485660435149086, 126.42061845677289),
          new kakao.maps.LatLng(33.490359551484325, 126.4211377999606),
          new kakao.maps.LatLng(33.49073230445039, 126.42090917694627)
      ]
  }, {
      name : '가시리',
      category: '가시리',
      path : [
          new kakao.maps.LatLng(33.395054923937245, 126.65341899579973),
          new kakao.maps.LatLng(33.392073538902935, 126.65670957203832),
          new kakao.maps.LatLng(33.38478004077197, 126.67323677835509),
          new kakao.maps.LatLng(33.379006561345335, 126.67420391513234),
          new kakao.maps.LatLng(33.374665601556934, 126.6965225372624),
          new kakao.maps.LatLng(33.37636386868157, 126.70187014826553),
          new kakao.maps.LatLng(33.37125364101927, 126.72074310912463),
          new kakao.maps.LatLng(33.364839538357565, 126.73516786611357),
          new kakao.maps.LatLng(33.35301426949498, 126.74237844782422),
          new kakao.maps.LatLng(33.34389730592915, 126.7508226047899),
          new kakao.maps.LatLng(33.34575023013112, 126.75775993096298),
          new kakao.maps.LatLng(33.33818232510901, 126.77612907261576),
          new kakao.maps.LatLng(33.33804874056494, 126.77623334152332),
          new kakao.maps.LatLng(33.33693396100938, 126.77835948764),
          new kakao.maps.LatLng(33.34083456552313, 126.78304470674993),
          new kakao.maps.LatLng(33.343999714041274, 126.79370725853646),
          new kakao.maps.LatLng(33.35121102222781, 126.79617772613769),
          new kakao.maps.LatLng(33.36812883997531, 126.79648197176391),
          new kakao.maps.LatLng(33.38263195181903, 126.7743014624999),
          new kakao.maps.LatLng(33.38232873608464, 126.76606978251114),
          new kakao.maps.LatLng(33.388975776145834, 126.76171887501968),
          new kakao.maps.LatLng(33.392788901245545, 126.74598738219798),
          new kakao.maps.LatLng(33.39807800149769, 126.73723395940769),
          new kakao.maps.LatLng(33.40956441585576, 126.73411050732261),
          new kakao.maps.LatLng(33.420269219732226, 126.74140476469631),
          new kakao.maps.LatLng(33.42672194187621, 126.73182531732459),
          new kakao.maps.LatLng(33.42548451348821, 126.72898974568244),
          new kakao.maps.LatLng(33.424420855140774, 126.72695006965463),
          new kakao.maps.LatLng(33.42189717830385, 126.70905827650284),
          new kakao.maps.LatLng(33.4132847244286, 126.6877282875148),
          new kakao.maps.LatLng(33.400237305745634, 126.66834399959431),
          new kakao.maps.LatLng(33.401958889152105, 126.66046356183598),
          new kakao.maps.LatLng(33.395054923937245, 126.65341899579973)
      ]
  }, {
      name : '하례리',
      category: '하례리',
      path : [
          new kakao.maps.LatLng(33.373159336828095, 126.55968500376453),
          new kakao.maps.LatLng(33.373676380093, 126.55371604488292),
          new kakao.maps.LatLng(33.367518577495176, 126.54248443716779),
          new kakao.maps.LatLng(33.35891547828147, 126.5591404131547),
          new kakao.maps.LatLng(33.349169743919816, 126.56472741867894),
          new kakao.maps.LatLng(33.33922218449338, 126.57728529180584),
          new kakao.maps.LatLng(33.33572252102019, 126.5860103169289),
          new kakao.maps.LatLng(33.32977748360063, 126.58803185876907),
          new kakao.maps.LatLng(33.31476389947684, 126.59988363184364),
          new kakao.maps.LatLng(33.2997221519568, 126.60154006660714),
          new kakao.maps.LatLng(33.296428880572265, 126.6050277580645),
          new kakao.maps.LatLng(33.28803554554704, 126.60442903757847),
          new kakao.maps.LatLng(33.2853277216815, 126.61445068614076),
          new kakao.maps.LatLng(33.27883928179127, 126.62006217238843),
          new kakao.maps.LatLng(33.26308211997893, 126.6247204695204),
          new kakao.maps.LatLng(33.25280732603033, 126.62333444855388),
          new kakao.maps.LatLng(33.257753123841844, 126.63930571156114),
          new kakao.maps.LatLng(33.261960916221554, 126.6407987783178),
          new kakao.maps.LatLng(33.26697574579942, 126.63453280367347),
          new kakao.maps.LatLng(33.29964823777193, 126.61678050572029),
          new kakao.maps.LatLng(33.30035865016625, 126.61677394180674),
          new kakao.maps.LatLng(33.31187848637235, 126.61891244006596),
          new kakao.maps.LatLng(33.320081698220086, 126.61547437365233),
          new kakao.maps.LatLng(33.3267928027197, 126.61663153197475),
          new kakao.maps.LatLng(33.33144544864512, 126.60954197175697),
          new kakao.maps.LatLng(33.33546801004612, 126.61085903510765),
          new kakao.maps.LatLng(33.34166245768163, 126.601181436063),
          new kakao.maps.LatLng(33.350390863452944, 126.60121940723214),
          new kakao.maps.LatLng(33.36727541815399, 126.57998337296019),
          new kakao.maps.LatLng(33.367892768884914, 126.57099645907049),
          new kakao.maps.LatLng(33.37175285823193, 126.56766260895158),
          new kakao.maps.LatLng(33.373159336828095, 126.55968500376453)
      ]
  }, {
      name : '사계리',
      category: '사계리',
      path : [
          new kakao.maps.LatLng(33.21800125233618, 126.29370045629899),
          new kakao.maps.LatLng(33.22684275958855, 126.30115673149061),
          new kakao.maps.LatLng(33.228178857170874, 126.30851458186093),
          new kakao.maps.LatLng(33.23636153196755, 126.31465388241294),
          new kakao.maps.LatLng(33.24068731993514, 126.32524775854493),
          new kakao.maps.LatLng(33.24157886411162, 126.32463801428148),
          new kakao.maps.LatLng(33.24187698028053, 126.32451499906918),
          new kakao.maps.LatLng(33.24197659138534, 126.32447871655852),
          new kakao.maps.LatLng(33.242127283016735, 126.32436864984129),
          new kakao.maps.LatLng(33.24224505048886, 126.32427235586654),
          new kakao.maps.LatLng(33.24473096112825, 126.32370660929527),
          new kakao.maps.LatLng(33.24545613577932, 126.32365841562421),
          new kakao.maps.LatLng(33.24581460742613, 126.32367324663514),
          new kakao.maps.LatLng(33.247123031709194, 126.32413763938835),
          new kakao.maps.LatLng(33.24753788624107, 126.32409216285735),
          new kakao.maps.LatLng(33.250720561674804, 126.3239737215394),
          new kakao.maps.LatLng(33.249730671208894, 126.31247284123545),
          new kakao.maps.LatLng(33.25047674345696, 126.29433992562569),
          new kakao.maps.LatLng(33.246455580962554, 126.29045310113135),
          new kakao.maps.LatLng(33.23936275635558, 126.28508366602719),
          new kakao.maps.LatLng(33.231173069270284, 126.28483061335399),
          new kakao.maps.LatLng(33.21800125233618, 126.29370045629899)
      ]
  }
];

var container = document.getElementById("map"); //지도를 담을 영역의 DOM 레퍼런스
var options = {
  //지도를 생성할 때 필요한 기본 옵션
  center: new kakao.maps.LatLng(33.409261, 126.545791), //지도의 중심좌표
  level: 9, //지도의 레벨(확대, 축소 정도)
};

//지도 생성 및 객체 리턴
var map = new kakao.maps.Map(container, options);

// 지도 확대 축소를 제어할 수 있는 줌 컨트롤을 생성
var zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

var currentCategory = null;
var polygonArray = [];

async function getDataSet(category) {
  let qs = category;
  if (!qs) {
    qs = "";
  }

  const dataSet = await axios({
    method: "get", // http method
    url: url + `/places?category=${qs}`,
    headers: {}, // packet header
    data: {}, // packet body
  });
  return dataSet.data.result;
}

getDataSet();

// 주소-좌표 변환 객체 생성
var geocoder = new kakao.maps.services.Geocoder();

// 주소-좌표 변환 함수
function getCoordsByAddress(address) {
  return new Promise((resolve, reject) => {
    // 주소로 좌표를 검색합니다
    geocoder.addressSearch(address, function (result, status) {
      // 정상적으로 검색이 완료됐으면
      if (status === kakao.maps.services.Status.OK) {
        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
        resolve(coords);
        return;
      }
      reject(new Error("getCoordsByAddress Error: not Vaild Address"));
    });
  });
}

function getContent(data) {
  return `
  <div class="infowindow">
      <div class="infowindow-img-container">
      </div>
      <div class="infowindow-body">
        <h5 class="infowindow-title">${data.title}</h5>
        <p class="infowindow-address">${data.address}</p>
        <a href="${data.placeUrl}" class="infowindow-navigate-to-store-btn" target="_blank">가게이동</a>
      </div>
      <div></div>
    </div>
  `;
}

// 다각형을 생상하고 이벤트를 등록하는 함수입니다
function displayArea(area) {
  if (area.category !== currentCategory) {
    return;
  }

  // 다각형을 생성합니다 
  var polygon = new kakao.maps.Polygon({
      map: map, // 다각형을 표시할 지도 객체
      path: area.path,
      strokeWeight: 1,
      strokeColor: '#000000',
      strokeOpacity: 0.8,
      fillColor: '#D8D8D8',
      fillOpacity: 0.6
  });

  let centerPoint = getPolygonCenter(area.path);

  kakao.maps.event.addListener(polygon, 'mouseover', function(mouseEvent) {
    polygon.setOptions({fillColor: '#013ADF'});
  });

  kakao.maps.event.addListener(polygon, 'mouseout', function() {
    polygon.setOptions({fillColor: '#D8D8D8'});
  });
  
  kakao.maps.event.addListener(polygon, 'click', function() {
    map.panTo(centerPoint);
  });
  
  polygonArray.push(polygon);  
}

async function setMap(dataSet) {
  markerArray = [];
  infowindowArray = [];

  for (var i = 0; i < dataSet.length; i++) {

    if (dataSet[i].category !== currentCategory) {
      continue;
    }

    // 마커 생성
    let coords = await getCoordsByAddress(dataSet[i].address);
    var marker = new kakao.maps.Marker({
      map: map, // 마커를 표시할 지도
      position: coords, // 마커를 표시할 위치
    });

    markerArray.push(marker);

    // 마커에 표시할 인포윈도우를 생성
    var infowindow = new kakao.maps.InfoWindow({
      content: getContent(dataSet[i]), // 인포윈도우에 표시할 내용
    });

    infowindowArray.push(infowindow);

    // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록
    // 이벤트 리스너로는 클로저를 만들어 등록
    // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록
    kakao.maps.event.addListener(
      marker,
      "click",
      makeOverListener(map, marker, infowindow, coords)
    );
    kakao.maps.event.addListener(map, "click", makeOutListener(infowindow));
  }
}

// 인포윈도우를 표시하는 클로저를 만드는 함수
function makeOverListener(map, marker, infowindow, coords) {
  return function () {
    // 1. 클릭시 다른 인포윈도우 닫기
    closeInfoWindow();
    infowindow.open(map, marker);
    // 2. 클릭한 곳으로 지도 중심 옮기기
    map.panTo(coords);
  };
}

let infowindowArray = [];
function closeInfoWindow() {
  for (let infowindow of infowindowArray) {
    infowindow.close();
  }
}

// 인포윈도우를 닫는 클로저를 만드는 함수
function makeOutListener(infowindow) {
  return function () {
    infowindow.close();
  };
}

// 카테고리
const categoryMap = {
  gujwaeup: "구좌읍",
  jocheoneup: "조천읍",
  aewoleup: "애월읍",
  gasiri: "가시리",
  haryeri: "하례리",
  sagyeri: "사계리",
};

function getPolygonCenter(path) {
  let latSum = 0, lngSum = 0, count = path.length;

  for(let i = 0; i < count; i++) {
      latSum += path[i].getLat();
      lngSum += path[i].getLng();
  }

  return new kakao.maps.LatLng(latSum / count, lngSum / count);
}

function clearPolygon() {
  for (polygon of polygonArray) {
    polygon.setMap(null);
  }
}

const categoryList = document.querySelector(".category-list");
categoryList.addEventListener("click", categoryHandler);

async function categoryHandler(event) {
  const categoryId = event.target.id;
  const category = categoryMap[categoryId];

  currentCategory = category;

  try {
    clearPolygon();

    for (var i = 0, len = areas.length; i < len; i++) {
      displayArea(areas[i]);
    }

    // 데이터 분류
    let categorizedDataSet = await getDataSet(category);

    // 기존 마커 삭제
    closeMarker();

    // 기존 인포윈도우 닫기
    closeInfoWindow();

    setMap(categorizedDataSet);
  } catch (error) {
    console.error(error);
  }
}

let markerArray = [];
function closeMarker() {
  for (marker of markerArray) {
    marker.setMap(null);
  }
}

async function setting() {
  try {
    const dataSet = await getDataSet();
    setMap(dataSet);
  } catch (error) {
    console.error(error);
  }
}

setting();
